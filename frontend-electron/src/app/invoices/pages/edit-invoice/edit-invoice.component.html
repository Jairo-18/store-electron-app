<app-base-page
  [headerTitle]="'Sistema de Facturación de Hotel'"
  [showContentTitle]="true"
  [showBackButton]="true"
  [showBorder]="false"
  backButtonRoute="/invoice/invoices/list"
  backButtonText="Volver"
  backButtonTooltip="Volver a la lista"
>
  <article class="flex flex-col md:flex-row gap-3 w-full h-full">
    <!-- Mostrar loader solo en carga inicial -->
    @if (initialLoading) {
    <div class="h-full w-full justify-center items-center flex">
      <app-loader></app-loader>
    </div>
    } @else {
    <!-- Columna izquierda -->
    <div class="flex flex-col w-full md:w-[75%] gap-3">
      <section class="flex flex-col p-4 rounded-2xl border border-[#06a606]">
        <!-- Información de la factura - aparece cuando invoiceData esté disponible -->
        @if (invoiceData) {
        <span class="text-base md:text-xl font-extrabold">
          {{ invoiceData.invoiceType.name || '' }} Nr°
          {{ invoiceData.code || '' }}
        </span>

        <section class="flex-row md:flex w-full">
          <div
            class="flex w-full md:w-[50%] justify-start text-sm md:text-base"
          >
            <span class="font-bold">
              {{
                invoiceData.invoiceType.code === 'FC'
                  ? 'Proveedor:'
                  : 'Cliente:'
              }}
              <span class="font-normal">
                {{ invoiceData.user.firstName || '' }}
                {{ invoiceData.user.lastName || '' }}
              </span>
            </span>
          </div>
        </section>
        }

        <!-- Tabs siempre visibles después de la carga inicial -->
        <mat-tab-group animationDuration="0ms">
          @if (invoiceData?.invoiceType?.code === 'FV') {
          <!-- Producto: siempre disponible -->
          <mat-tab label="Producto">
            <ng-template matTabContent>
              <app-add-product
                [categoryTypes]="categoryTypes"
                [taxeTypes]="taxeTypes"
                (itemSaved)="onItemSaved()"
              ></app-add-product>
            </ng-template>
          </mat-tab>

          } @else {

          <mat-tab label="Productos">
            <ng-template matTabContent>
              <app-add-invoice-buy
                [categoryTypes]="categoryTypes"
                [taxeTypes]="taxeTypes"
                (itemSaved)="onItemSaved()"
              ></app-add-invoice-buy>
            </ng-template>
          </mat-tab>

          }
        </mat-tab-group>
      </section>

      <!-- Detalle factura - aparece cuando invoiceData esté disponible -->
      <section
        class="flex flex-col p-2 md:p-4 rounded-2xl border border-[#06a606]"
      >
        <div class="w-full text-center">
          <span class="font-bold">Servicios y Productos Ingresados</span>
        </div>
        <app-invoice-detaill
          *ngIf="invoiceData"
          [invoiceDetaills]="invoiceData.invoiceDetaills"
          [invoiceId]="invoiceId"
          [reload]="reloadInvoiceDetails"
          (itemDelete)="onItemDeleted()"
        ></app-invoice-detaill>
      </section>
    </div>

    <!-- Columna derecha - aparece cuando invoiceData esté disponible -->
    <div
      class="flex flex-col w-full md:w-[25%] p-2 md:p-4 h-min rounded-2xl border border-[#06a606]"
    >
      <app-invoice-summary
        *ngIf="invoiceData"
        [invoiceData]="invoiceData"
        [paidTypes]="paidTypes"
        [payTypes]="payTypes"
        (downloadRequested)="downloadInvoice()"
        (editRequested)="openEditInvoiceDialog()"
      ></app-invoice-summary>
    </div>
    }
  </article>
  <app-invoice-pdf
    class="hidden"
    *ngIf="invoiceData"
    [invoiceData]="invoiceData"
    #invoiceToPrint
  ></app-invoice-pdf>
</app-base-page>
